<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:HangmanGame.ViewModels"
    xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
    x:Class="HangmanGame.Views.GamePage"
    Shell.NavBarIsVisible="False"
    BackgroundColor="{AppThemeBinding Light=#F7F7F7, Dark=#1E1E1E}">

    <ContentPage.BindingContext>
        <vm:GameViewModel />
    </ContentPage.BindingContext>

    <Grid Padding="16" RowSpacing="12"
          RowDefinitions="Auto, Auto, *, Auto, Auto">

        <!-- 1. Üst Bar (HUD) -->
        <Border Grid.Row="0" 
                Padding="12,8" 
                StrokeShape="RoundRectangle 24"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2C}">
            <Grid ColumnDefinitions="Auto, *, Auto, Auto" ColumnSpacing="16" VerticalOptions="Center">
                
                <Button Grid.Column="0" Text="&#xe88a;" FontFamily="MaterialIcons" FontSize="28" Clicked="ImageButton_Clicked" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" Padding="0"/>

                <HorizontalStackLayout Grid.Column="1" Spacing="16" VerticalOptions="Center" HorizontalOptions="End">
                    <!-- Score -->
                    <HorizontalStackLayout Spacing="4" VerticalOptions="Center">
                        <Label Text="&#xe838;" FontFamily="MaterialIcons" FontSize="24" VerticalOptions="Center" TextColor="Gold"/>
                        <Label Text="{Binding Score}" FontSize="20" FontAttributes="Bold" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    
                    <!-- Misses -->
                    <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                        <Label Text="&#xe87d;" FontFamily="MaterialIcons" FontSize="24" VerticalOptions="Center" TextColor="#FF5252"/>
                        <Label Text="{Binding TriesText}" FontSize="20" FontAttributes="Bold" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </HorizontalStackLayout>

                <Button Grid.Column="2" Text="{Binding SoundIcon}" FontFamily="MaterialIcons" FontSize="28" Command="{Binding ToggleMusicCommand}" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" Padding="0"/>
                <Button Grid.Column="3" Text="&#xe5cd;" FontFamily="MaterialIcons" FontSize="28" Clicked="OnExitClicked" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" Padding="0"/>
            </Grid>
        </Border>

        <!-- 2. Adam Asmaca Alanı -->
        <Border Grid.Row="1" Grid.RowSpan="2"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2C}"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 20"
                Padding="16"
                Margin="0,10,0,0">
            <skia:SKCanvasView
                x:Name="CanvasView"
                PaintSurface="OnCanvasViewPaintSurface"
                VerticalOptions="Fill"
                HorizontalOptions="Center" />
        </Border>

        <!-- İpucu ve Kelime Alanı -->
        <VerticalStackLayout Grid.Row="3" Spacing="8" Padding="10" HorizontalOptions="Center" VerticalOptions="Center" Margin="0,10,0,0">
            <Label
                Text="{Binding HintText}"
                FontSize="16"
                HorizontalOptions="Center"
                HorizontalTextAlignment="Center"
                TextColor="{AppThemeBinding Light=Gray, Dark=LightGray}" />
            <Label
                Text="{Binding WordDisplay}"
                FontSize="32"
                FontAttributes="Bold"
                HorizontalOptions="Center" />
        </VerticalStackLayout>

        <!-- Klavye -->
        <VerticalStackLayout
            Grid.Row="4"
            x:Name="KeyboardLayout"
            Spacing="8"
            BindableLayout.ItemsSource="{Binding KeyboardRows}"
            HorizontalOptions="Center"
            VerticalOptions="End">

            <!-- Klavye Satır Şablonu -->
            <BindableLayout.ItemTemplate>
                <DataTemplate>
                    <FlexLayout JustifyContent="Center" Wrap="Wrap" BindableLayout.ItemsSource="{Binding .}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Text="{Binding .}"
                                    Command="{Binding BindingContext.GuessCommand, Source={x:Reference GamePage}}"
                                    CommandParameter="{Binding .}"
                                    Clicked="OnKeyClicked"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    Margin="3"
                                    Padding="12,16"
                                    TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark=White}"
                                    BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2C}"
                                    BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
                                    BorderWidth="1">
                                    <Button.Shadow>
                                        <Shadow Brush="#000000" Offset="2,2" Radius="4" Opacity="0.1" />
                                    </Button.Shadow>
                                </Button>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </FlexLayout>
                </DataTemplate>
            </BindableLayout.ItemTemplate>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
