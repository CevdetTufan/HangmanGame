<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:HangmanGame.ViewModels"
    xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
    x:Class="HangmanGame.Views.GamePage"
    Shell.NavBarIsVisible="False"
    BackgroundColor="White">

    <!-- Klavye Tuş Şablonu -->
    <ContentPage.Resources>
        <DataTemplate x:Key="KeyTemplate">
            <Button
                Text="{Binding .}"
                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GameViewModel}}, Path=GuessCommand}"
                CommandParameter="{Binding .}"
                FontSize="16"
                WidthRequest="34"
                HeightRequest="48"
                CornerRadius="6"
                TextColor="Black"
                BackgroundColor="White"
                BorderColor="Black"
                BorderWidth="1" />
        </DataTemplate>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:GameViewModel />
    </ContentPage.BindingContext>

    <Grid Padding="20" RowSpacing="12"
          RowDefinitions="Auto,250,Auto,Auto,Auto">

        <!-- 1. Üst Bar -->
        <HorizontalStackLayout Grid.Row="0"
                               Spacing="16"
                               HorizontalOptions="Center"
                               VerticalOptions="Center">
            <!-- Ana Sayfa -->
            <ImageButton Source="home.png"
                         Clicked="ImageButton_Clicked"
                         WidthRequest="32"
                         HeightRequest="32"
                         BackgroundColor="Transparent" />

            <!-- Can -->
            <HorizontalStackLayout Spacing="4" VerticalOptions="Center">
                <Label Text="❤️" FontSize="18" />
                <Label Text="{Binding TriesText}" FontSize="16" TextColor="Black" />
            </HorizontalStackLayout>

            <!-- Ses -->
            <ImageButton Source="sound_on.png"
                         Clicked="OnToggleMusicClicked"
                         WidthRequest="32"
                         HeightRequest="32"
                         BackgroundColor="Transparent" />

            <!-- Çık -->
            <Button Text="Çık"
                    FontSize="14"
                    Padding="10,2"
                    Clicked="OnExitClicked"
                    BackgroundColor="#EEE"
                    CornerRadius="8" />
        </HorizontalStackLayout>

        <!-- 2. Adam Asmaca Çizimi -->
        <skia:SKCanvasView
            Grid.Row="1"
            x:Name="CanvasView"
            PaintSurface="OnCanvasViewPaintSurface"
            VerticalOptions="Fill"
            HorizontalOptions="Center"
            HeightRequest="250"
            Margin="0" />

        <!-- 3. Soru -->
        <Label
            Grid.Row="2"
            Text="{Binding HintText}"
            FontSize="20"
            FontAttributes="Bold"
            HorizontalOptions="Center"
            TextColor="Black"
            Margin="0" />

        <!-- 4. Kelime (Tahmin edilen harfler) -->
        <Label
            Grid.Row="3"
            Text="{Binding WordDisplay}"
            FontSize="26"
            TextColor="Black"
            HorizontalOptions="Center"
            Margin="0,5,0,0" />

        <!-- 5. Klavye -->
        <StackLayout
            Grid.Row="4"
            Spacing="6"
            HorizontalOptions="Center"
            Margin="0,5,0,0"
            MaximumWidthRequest="360">

            <!-- Satır 1 -->
            <StackLayout Orientation="Horizontal" Spacing="4"
                         HorizontalOptions="CenterAndExpand"
                         BindableLayout.ItemsSource="{Binding KeyboardRows[0]}"
                         BindableLayout.ItemTemplate="{StaticResource KeyTemplate}" />

            <!-- Satır 2 -->
            <StackLayout Orientation="Horizontal" Spacing="4" Padding="18,0,0,0"
                         HorizontalOptions="CenterAndExpand"
                         BindableLayout.ItemsSource="{Binding KeyboardRows[1]}"
                         BindableLayout.ItemTemplate="{StaticResource KeyTemplate}" />

            <!-- Satır 3 -->
            <StackLayout Orientation="Horizontal" Spacing="4" Padding="36,0,0,0"
                         HorizontalOptions="CenterAndExpand"
                         BindableLayout.ItemsSource="{Binding KeyboardRows[2]}"
                         BindableLayout.ItemTemplate="{StaticResource KeyTemplate}" />
        </StackLayout>
    </Grid>
</ContentPage>
